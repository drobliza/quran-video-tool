name: Auto Video Upload

on:
  schedule:
    # Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø¨ØªÙˆÙ‚ÙŠØª UTC (Ù†Ø¶ÙŠÙ -1 Ø³Ø§Ø¹Ø© Ø¹Ù† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± UTC+1)
    - cron: '0 11 * * *'   # 12:00 Ø¸Ù‡Ø±Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±
    - cron: '0 17 * * *'   # 18:00 Ù…Ø³Ø§Ø¡Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±
    - cron: '0 20 * * *'   # 21:00 Ù…Ø³Ø§Ø¡Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±
  workflow_dispatch:       # Ù„ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† GitHub Actions Ø£ÙŠØ¶Ø§Ù‹

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: â–¶ï¸ Run upload_video.py
        id: run_script
        run: |
          echo "â³ Running script..."
          python upload_video.py > output.log 2>&1 || true

      - name: ğŸ“¤ Send Telegram notification
        if: always()
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          MESSAGE="âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ $(date '+%Y-%m-%d %H:%M') Ø¨ØªÙˆÙ‚ÙŠØª UTC.
ğŸ“ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹: $GITHUB_REPOSITORY
ğŸ”— https://github.com/$GITHUB_REPOSITORY/actions/runs/${{ github.run_id }}"
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d text="$MESSAGE" \
            -d parse_mode="Markdown"

      - name: ğŸ§¹ Clean up video files
        run: |
          echo "ğŸ§¹ Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø§ØªØ¬Ø©..."
          rm -f ./*.mp4 ./*.avi ./*.mov || true
